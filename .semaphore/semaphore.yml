version: v1.0
name: Playwright CI

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004

blocks:
  - name: Install & Test
    task:
      jobs:
        - name: run tests
          commands:
            - checkout
            - sem-version node 20.15.1
            - npm ci
            - npx playwright install --with-deps
            - npx playwright test
            - 'echo "PWD=$(pwd)" && ls -lah'
            - 'test -f report.xml && echo "✅ report.xml found" || echo "⚠️ report.xml not in root"'
      epilogue:
        always:
          commands:
            # publish JUnit to Tests tab (try root first, then search)
            - '[[ -f report.xml ]] && test-results publish report.xml || REPORT=$(git ls-files -co --exclude-standard | grep -E "(^|/)report\.xml$" || true) && [[ -n "$REPORT" ]] && test-results publish "$REPORT"'
            # upload HTML report folder
            - artifacts push workflow playwright-report

