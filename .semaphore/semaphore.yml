version: v1.0
name: Playwright CI

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004

blocks:
  - name: Install & Test
    task:
      jobs:
        - name: run tests
          commands:
            - checkout
            - sem-version node 20.15.1
            - npm ci
            - npx playwright install --with-deps
            - npx playwright test
            - 'echo "PWD=$(pwd)" && ls -lah'
            - 'test -f report.xml && echo "✅ report.xml found" || echo "⚠️ report.xml missing"'
      epilogue:
        always:
          commands:
            - test-results publish report.xml
            - artifacts push workflow playwright-report

after_pipeline:
  - name: Merge test results
    task:
      jobs:
        - name: merge
          commands:
            - test-results gen-pipeline-report


