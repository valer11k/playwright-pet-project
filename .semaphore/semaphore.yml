version: v1.0
name: Playwright CI

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004

blocks:
  - name: Install & Test
    task:
      jobs:
        - name: run tests
          commands:
            - checkout
            - sem-version node 20.15.1
            - npm ci
            - npx playwright install --with-deps
            - npx playwright test
      epilogue:
        always:
          commands:
            - '[[ -f report.xml ]] && test-results publish report.xml'
            - artifacts push workflow playwright-report